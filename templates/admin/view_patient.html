{% extends "admin/base.html" %}
{% block title %}Patient Details{% endblock %}

{% block content %}
<script>
  guard();
</script>

<h4 class="mb-4">ğŸ§‘â€âš•ï¸ Patient Details</h4>

<!-- ================= PATIENT BASIC INFO ================= -->
<div class="card shadow-sm mb-4">
  <div class="card-header bg-light">
    <b>ğŸ‘¤ Basic Information</b>
  </div>
  <div class="card-body">
    <div class="row">
      <div class="col-md-4">
        <p><b>Name:</b> {{ patient.user.name }}</p>
        <p><b>Phone:</b> {{ patient.user.phone }}</p>
        <p><b>Email:</b> {{ patient.user.email or "-" }}</p>
      </div>

      <div class="col-md-4">
        <p><b>Age:</b> {{ patient.age }}</p>
        <p><b>Gender:</b> {{ patient.gender }}</p>
        <p><b>Address:</b> {{ patient.address }}</p>
      </div>

      <div class="col-md-4">
        <p><b>Service Start:</b> {{ patient.service_start }}</p>
        <p>
          <b>Service End:</b>
          {{ patient.service_end if patient.service_end else "â€”" }}
        </p>
        <p>
          <b>Assigned Doctor:</b>
          {% if doctor %}
            Dr. {{ doctor.user.name }} ({{ doctor.specialization }})
          {% else %}
            <span class="text-muted">Not Assigned</span>
          {% endif %}
        </p>
      </div>
    </div>
  </div>
</div>

<!-- ================= NURSE VISITS ================= -->
<div class="card shadow-sm mb-4">
<!-- ================= NURSE VISITS ================= -->
<div class="card shadow-sm mb-4">
  <div class="card-header bg-light">
    <b>ğŸ‘©â€âš•ï¸ Nurse Visits</b>
  </div>
  <div class="card-body">
    {% if duties %}
    <table class="table table-sm table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>Nurse</th>
          <th>Nurse Type</th>
          <th>Duty Type</th>
          <th>Shift</th>
          <th>Start</th>
          <th>End</th>
        </tr>
      </thead>
      <tbody>
        {% for duty in duties %}
        <tr>
          <td>{{ duty.nurse.user.name }}</td>
          <td>{{ duty.nurse.nurse_type }}</td>
          <td>{{ duty.duty_type }}</td>
          <td>{{ duty.shift }}</td>
          <td>{{ duty.duty_start.strftime("%d %b %Y %H:%M") }}</td>
          <td>{{ duty.duty_end.strftime("%d %b %Y %H:%M") }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="text-muted">No nurse visits recorded.</p>
    {% endif %}
  </div>
</div>

<!-- ================= DAILY NOTES ================= -->
<div class="card shadow-sm mb-4">
  <div class="card-header bg-light">
    <b>ğŸ“ Daily Nursing Notes</b>
  </div>
  <div class="card-body">
    {% if notes %}
    <table class="table table-sm table-bordered">
      <thead class="table-light">
        <tr>
          <th>Nurse</th>
          <th>Note</th>
          <th>Time</th>
        </tr>
      </thead>
      <tbody>
        {% for n in notes %}
        <tr>
          <td>{{ n.nurse.user.name }}</td>
          <td>{{ n.note }}</td>
          <td>{{ n.created_at.strftime("%d %b %Y %H:%M") }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="text-muted">No notes available.</p>
    {% endif %}
  </div>
</div>

<!-- ================= VITALS ================= -->
<div class="card shadow-sm mb-4">
  <div class="card-header bg-light">
    <b>â¤ï¸ Patient Vitals</b>
  </div>
  <div class="card-body">
    {% if vitals %}
    <table class="table table-sm table-bordered text-center">
      <thead class="table-light">
        <tr>
          <th>Recorded At</th>
          <th>BP</th>
          <th>Pulse</th>
          <th>SpO2</th>
          <th>Temp (Â°C)</th>
          <th>Sugar</th>
        </tr>
      </thead>
      <tbody>
        {% for v in vitals %}
        <tr>
          <td>{{ v.recorded_at.strftime("%d %b %Y %H:%M") }}</td>
          <td>{{ v.bp }}</td>
          <td>{{ v.pulse }}</td>
          <td>{{ v.spo2 }}</td>
          <td>{{ v.temperature }}</td>
          <td>{{ v.sugar if v.sugar else "-" }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="text-muted">No vitals recorded.</p>
    {% endif %}
  </div>
</div>

<!-- ================= MEDICATIONS ================= -->
<div class="card shadow-sm mb-4">
  <div class="card-header bg-light">
    <b>ğŸ’Š Prescribed Medications</b>
  </div>
  <div class="card-body">
    {% if medications %}
    <table class="table table-sm table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>Medicine</th>
          <th>Dosage</th>
          <th>Timing</th>
          <th>Duration (Days)</th>
          <th>Price</th>
        </tr>
      </thead>
      <tbody>
        {% for m in medications %}
        <tr>
          <td>{{ m.medicine_name }}</td>
          <td>{{ m.dosage }}</td>
          <td>{{ m.timing | join(", ") }}</td>
          <td>{{ m.duration_days }}</td>
          <td>
            {% if m.price %}
              â‚¹ {{ m.price }}
            {% else %}
              <span class="text-muted">N/A</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="text-muted">No medications prescribed.</p>
    {% endif %}
  </div>
</div>

{% endblock %}
