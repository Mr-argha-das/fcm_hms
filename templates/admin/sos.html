{% extends "admin/base.html" %}

{% block title %}SOS Alerts{% endblock %}

{% block content %}

<div class="card mb-4 border-danger">

  <!-- HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5 class="mb-0 text-danger">üö® SOS Alerts</h5>

    <div class="d-flex gap-2">
      <button class="btn btn-sm btn-outline-danger" onclick="location.reload()">
        üîÑ Refresh
      </button>
    </div>
  </div>

  <!-- SOS TABLE -->
  <table class="table table-hover align-middle table-danger">
    <thead class="table-light">
      <tr>
        <th>Patient</th>
        <th>Address / Ward</th>
        <th>Alert Type</th>
        <th>Time</th>
        <th>Status</th>
        <th class="text-center">Actions</th>
      </tr>
    </thead>

    <tbody>
      {% if sos_alerts %}
        {% for sos in sos_alerts %}
        <tr>

          <!-- PATIENT -->
          <td>
            {{ sos.patient.user.name if sos.patient else "N/A" }}
          </td>

          <!-- ROOM / WARD -->
          <td>
            {{sos.patient.address if sos.patient else "N/A"}}
          </td>

          <!-- ALERT TYPE -->
          <td>
            <span class="badge bg-danger">
              SOS Alert
            </span>
          </td>

          <!-- TIME AGO -->
          <td>
            {% set diff = (now - sos.created_at).total_seconds() %}
            {% if diff < 60 %}
              Just now
            {% elif diff < 3600 %}
              {{ (diff // 60)|int }} mins ago
            {% else %}
              {{ (diff // 3600)|int }} hrs ago
            {% endif %}
          </td>

          <!-- STATUS -->
          <td>

              <span class="badge bg-secondary">{{ sos.status }}</span>

          </td>

          <!-- ACTIONS -->
          <td class="text-center">
            <button class="btn btn-sm btn-outline-primary" title="View Details" onclick="location.href='/admin/sos/{{ sos.id }}'">
              üëÅÔ∏è
            </button>

            {% if not sos.patient or not sos.patient.service_end %}
              <button class="btn btn-sm btn-outline-warning" title="Acknowledge">
                ‚ö†Ô∏è
              </button>

              <button class="btn btn-sm btn-outline-success" title="Resolve">
                ‚úÖ
              </button>
            {% endif %}
          </td>

        </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="6" class="text-center text-muted">
            No SOS alerts found
          </td>
        </tr>
      {% endif %}
    </tbody>
  </table>

</div>

{% endblock %}
